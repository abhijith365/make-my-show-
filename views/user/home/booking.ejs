<!-- header -->
<%- include('../../partials/header.ejs', {user}) %>
    <div class="buyticket-page">
        <section class="movie-details">
            <div class="fix-height-div">
                <!-- Position absolute divs starts here -->
                <div class="top-section-container d-flex">
                    <div class="movie-details-container">
                        <div class="text-details">
                            <h1>
                                <div class="cinema-name-wrapper" style="padding: 0; margin:0;">
                                    <a style="padding-left:2rem;" href="/home/movie/<%- data[0].movies[0]._id%>"
                                        class="">
                                        <%-data[0].movies[0].movieName %>
                                    </a>
                                </div>
                            </h1>
                            <div class="__more-movie-data">
                                <span class="__censor">

                                </span>
                                <span class="heart-rating" style="display: inline;">
                                    <span class="heart-icon">

                                        <i class="fa fa-heart" aria-hidden="true"></i>

                                    </span>
                                    <span class="__percent">
                                        <%- Math.floor(Math.random()*20)+80 %> %
                                    </span><br>
                                    <span class="__votes">
                                        <%- Math.floor(Math.random()*100000)+10000 %> VOTES
                                    </span>
                                </span>
                                <span class="__tags">
                                    <% data[0].movies[0].movieGenres.split(',').forEach(e=>{ %>
                                        <span class="__genre-tag">
                                            <%- e %>
                                        </span>
                                        <% } )%>

                                            <span style="display:none">
                                                <%-data[0].movies[0].language %>
                                            </span>
                                </span>
                                <span class="__release-date" content="2022-06-03" itemprop="datePublished">
                                    <%-data[0].movies[0].ReleseDate.toString().split(" ").slice(0,4).join(" ") %>

                                </span>

                                <span class="clock-time-buyticktes">
                                    <span class="__clock-icon">
                                        <i class="fa fa-clock-o" aria-hidden="true"></i>

                                    </span>

                                    <span class="__time" itemprop="duration">
                                        <%-data[0].movies[0].movieDuration.split(":").join(" hrs ") %> mins</span>
                                    <br>
                                    <span class=" __selected-category">2D
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="filters-wrapper">
                <div class="filters-container">

                    <div class="showtime-filters struktur ">
                        <div class="dates-wrapper " style="display: inline-block;">
                            <ul id="showDates" class="dates-container slick-initialized slick-slider"><button
                                    class="buttons prev slick-arrow slick-disabled" aria-label="Previous" role="button"
                                    href="#" aria-disabled="true" style="display: block;">
                                    <i class="fa fa-arrow-left fa-1x" aria-hidden="true"></i></button>
                                <div aria-live="polite" class="slick-list draggable">
                                    <div class="slick-track"
                                        style="opacity: 1; width: 35000px; transform: translate3d(-1px, 0px, 0px);">

                                        <!-- finding max day for shows -->

                                        <!-- finding reming days -->
                                        <% let findMax = new Date(Math.max(...data.map(e => new Date(e.showByDate.endDate)))); %> 
                                        <% let date1 =  new Date(data[data.length-1].showByDate.endDate.toISOString().split("T")[0])%> 
                                        <% let date2 = new Date(new Date().toISOString().split("T")[0]) %> 
                                        <%const maxday=(Math.ceil((date1.getTime() - date2.getTime()) / (1000 * 3600 * 24))) %>
                                        <%- console.log(data, maxday) %> 
                                            <% for( let i=0; i <maxday; i++ ) { %>
                                                <% let startDate=data[0].showByDate.startDate.toString()%>
                                                    <%let date=new Date();%>
                                                        <%m=date.setDate(date.getDate() + i); %>

                                                            <li class="<%= i==0 ?`date-details _active slick-slide slick-current slick-active `:`date-details  slick-slide`%>"
                                                                data-slick-index=<%-i %>
                                                                aria-hidden="false">
                                                                <a class="date-href" href="/home/booking/<%- data[0].movies[0]._id%>?&dt=<%-new Date(m).toISOString().split("T")[0]%>"
                                                                    data-url="/home/booking/<%- data[0].movies[0]._id%>?&dt=<%-new Date(m).toISOString().split("T")[0]%>"
                                                                    data-date="<%-new Date(m).toISOString().split("T")[0]%>"
                                                                    data-id="<%- data[0].movies[0]._id%>" >

                                                                                <div class="date-day">
                                                                                    <%-new Date(m).toString().split(" ")[0]%>
                                                                                </div>
                                                                                <div class=" date-numeric">
                                                                                    <%-parseInt(new Date(m).toString().split(" ")[2])%>
                                                                                 </div>
                                                                                 <div class="date-month">
                                                                                     <%-new Date(m).toString().split(" ")[1]%>
                                                                                </div>
                                                                </a>
                                                            </li>

                                             <% } %>
                                    </div>
                                </div>


                                <button class=" buttons next slick-arrow"
                                   aria-label="Next" role="button"
                                    href="#"tyle="display: block;"
                                     aria-disabled="false">

                                    <i class="fa fa-arrow-right fa-1x"aria-hidden="true"></i> 
                                </button>
                                
                            </ul>
                        </div>
                        <div class="dropdown-block ">


                            <button class="btn _tres __done">DONE</button>

                            <div class="dropdown highlighted _disabled">
                                <div class="__text _languages-text _highlighted">
                                    <%-data[0].movies[0].language %> - 2D
                                </div>
                                <i class="__icon icon-arrow-down ">
                                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg"
                                        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100"
                                        enable-background="new 0 0 100 100" xml:space="preserve">
                                        <use xlink:href="/icons/common-icons.svg#icon-arrow-down-new"></use>
                                    </svg>
                                </i>

                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </section>


        <!-- theatre details -->
        <section class="phpShowtimes showtimes">


            <div class="applied-filters wrapper">

                <div class="added-filters"></div>
            </div>
            <div class="wrapper">
                <div class="container">
                    <div class="attributes-container">
                        <div class="offer-details-container legends-section">
                        </div>
                        <div class="legends-container">
                            <div class="showtimes-legend">
                                <div class="legend-icon"></div>
                                <div class="legend-text">Available</div>
                            </div>
                            <div class="showtimes-legend">
                                <div class="legend-icon fast"></div>
                                <div class="legend-text">Fast Filling</div>
                            </div>

                        </div>
                    </div>

                    <ul id="venuelist">

                        <% data.map(d=>d.theatres.forEach(item=>{ %>

                            <li class="list">
                                <div class="listing-info">
                                    <div class="img-container">
                                        <span class="icon-star star"></span>
                                    </div>
                                    <div class="details">
                                        <span class="heart-it" data-id="CCKL">
                                            <i class="fa fa-heart" aria-hidden="true"></i>

                                        </span>
                                        <span class="icon-location">
                                            <i class="fa fa-location-arrow" aria-hidden="true"></i>
                                        </span>
                                        <div class="__name ">
                                            <div class="__title">
                                                <a class="__venue-name" href="/buytickets/">
                                                    <%-item.theatreName %>
                                                        Cinemas: <%-item.BuildingName %>
                                                            , <%-item.city %>
                                                </a>
                                                <div class="info-section">
                                                    <img src="https://in.bmscdn.com/moviemode/cinemaphotoshowcase/safety_first.png"
                                                        class="venue-info-icon lazy"
                                                        onerror="this.src='https:/\/\in.bmscdn.com/m6/images/common/placeholder.png'; this.onerror='';">
                                                    <div class="venue-info-text">INFO</div>
                                                </div>
                                            </div>
                                            <div class="st-distance _none">
                                                <span class="__dis-icon">
                                                    <i class="fa fa-location-arrow" aria-hidden="true"></i>
                                                    </svg>
                                                </span>
                                                <span class="__distance"></span>
                                            </div>
                                            <div class="unpaid-mticket-wrapper">

                                                <div class="__mticket-info">
                                                    <span class="icon">
                                                        <i class="fa fa-mobile" style="color:rgba(0, 128, 0, 0.661)"
                                                            aria-hidden="true"></i>
                                                    </span>
                                                    <label>M-Ticket</label>
                                                </div>
                                                <div class="__fnb-info ">
                                                    <span class="icon">
                                                        <i class="fa fa-burger-glass"></i>
                                                    </span>
                                                    <label>Food &amp; Beverage</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="body showtimes-details-container ">
                                    <div class="offer-details-container">
                                    </div>
                                    <div class="showtime-pill-wrapper">
                                        <% d.showByDay.map(e=>{%>
                                            <% var da=date.toString(); var cdate=`${date}T${e.startTime}`;let tr = new Date()<new Date(cdate); %>
                                             <%-(!tr)?`<div class="showtime-pill-container _sold" >`:`<div class="showtime-pill-container" >`%> 
                                                <a class="showtime-pill show_time_url"
                                                
                                                   <%-(tr)? `href=/home/bookticket/seat/${d._id}?&t=${e.startTime}&d=${date}`:`` %> 
                                                    data-url=" /home/bookticket/seat/<%-d._id%>?&t=<%-e.startTime%>&d=<%- date %>"
                                                    data-id="<%-d._id%>" data-time="<%-e.startTime%>" data-date="<%-e.startTime%>&d=<%- date %>"
                                                    data-date="<%- date %>">
                                                    <div class="__details">
                                                        <div class="__text">
                                                            <%-moment(e.startTime, ["HH.mm"]).format("hh:mm A")%>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                            <% }) %>

                                                <!-- <div class="showtime-pill-container _filling" data-online="Y">
                                                    <a class="showtime-pill" href="/booktickets/CCKL/8240">
                                                        <div class="__details">
                                                            <div class="__text">
                                                                07:30 PM </div>
                                                        </div>
                                                    </a>
                                                </div> -->

                                    </div>
                                    <div class="venue-flags">
                                        <span class="gold-icon"></span>
                                        <span class="venue-flags-details">Cancellation Available</span>
                                    </div>
                                </div>
                            </li>
                            <% }) )%>
                                <!-- loop end -->
                    </ul>
                </div>
            </div>

            <!-- Breadcrumb HTML -->

        </section>
    </div>
    <!-- footer -->
    <%- include('../partials/footer.ejs') %>
        <script type="text/JavaScript" src=" https://MomentJS.com/downloads/moment.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="/js/user_helper/theatre_select_page.js"></script>
